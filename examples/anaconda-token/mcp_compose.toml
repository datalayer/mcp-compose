# MCP Compose Configuration
# Anaconda Authentication Example

[composer]
name = "anaconda-compose"
conflict_resolution = "prefix"  # Prefix tool names with server name
log_level = "INFO"

# ============================================================================
# Authentication Configuration
# ============================================================================
# Anaconda bearer token validation
# The composer validates incoming bearer tokens using:
#   from anaconda_auth.token import TokenInfo
#   TokenInfo(domain="anaconda.com", api_key=bearer_token).get_access_token()
#
# Clients must provide valid Anaconda bearer tokens in Authorization header:
#   Authorization: Bearer <your_anaconda_token>

[authentication]
enabled = true
providers = ["anaconda"]
default_provider = "anaconda"

[authentication.anaconda]
domain = "anaconda.com"

# ============================================================================
# Backend MCP Servers (No auth - accessed via composer only)
# ============================================================================

# Environments MCP Server (Proxied via STDIO)
[[servers.proxied.stdio]]
name = "environments"
command = ["python", "-m", "environments_mcp_server", "start", "--transport", "stdio"]
restart_policy = "never"

# Calculator MCP Server (Proxied via STDIO)
[[servers.proxied.stdio]]
name = "calculator"
command = ["python", "mcp1.py"]
restart_policy = "never"
# Calculator tools: add, subtract, multiply, divide

# Echo MCP Server (Proxied via SSE)
# Start the SSE server with: python mcp2_sse.py
[[servers.proxied.sse]]
name = "echo"
url = "http://localhost:8081/sse"
timeout = 30
keep_alive = true
reconnect_on_failure = true
max_reconnect_attempts = 10
health_check_enabled = false
mode = "proxy"
# Echo tools: ping, echo, reverse, uppercase, lowercase, count_words

# Echo MCP Server via HTTP Streaming (JSON Lines)
# [[servers.proxied.http]]
# name = "echo"
# url = "http://localhost:8082/stream"
# protocol = "lines"  # Options: lines, chunked, poll
# timeout = 30
# keep_alive = true
# reconnect_on_failure = true
# max_reconnect_attempts = 10
# poll_interval = 2
# health_check_enabled = false
# mode = "proxy"
# Note: Start the HTTP server with: python mcp2_http.py

# Jupyter MCP Server (Proxied via Streamable HTTP)
# Uses native MCP Streamable HTTP transport
# Start JupyterLab first: make jupyterlab
[[servers.proxied.http]]
name = "jupyter"
url = "http://localhost:8888/mcp"
protocol = "streamable-http"
timeout = 30
keep_alive = true
reconnect_on_failure = true
max_reconnect_attempts = 10
health_check_enabled = false
mode = "proxy"
