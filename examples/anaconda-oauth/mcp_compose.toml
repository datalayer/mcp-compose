# MCP Compose Configuration
# Anaconda OAuth2 Authentication Example
#
# This example demonstrates using the generic OAuth2 provider with Anaconda's
# OIDC endpoints. Unlike the anaconda-token example (which uses anaconda-auth
# library for token validation), this uses standard OAuth2/OIDC token validation.

[composer]
name = "anaconda-oauth-composer"
conflict_resolution = "prefix"  # Prefix tool names with server name
log_level = "INFO"

# ============================================================================
# Authentication Configuration
# ============================================================================
# Generic OAuth2 token validation using Anaconda's OIDC endpoints.
#
# The composer validates incoming bearer tokens by:
# 1. Auto-discovering endpoints from the issuer_url
# 2. Calling the userinfo endpoint with the bearer token
# 3. Extracting user ID from the configured claim (default: "sub")
#
# Clients must provide valid Anaconda OAuth tokens in Authorization header:
#   Authorization: Bearer <your_anaconda_oauth_token>
#
# To get an OAuth token, clients should:
#   from anaconda_auth import login
#   login()  # Interactive OAuth flow
#   from anaconda_auth.token import TokenInfo
#   token = TokenInfo().get_access_token()

[authentication]
enabled = true
providers = ["oauth2"]
default_provider = "oauth2"

[authentication.oauth2]
# Use generic provider for standard OAuth2/OIDC token validation
provider = "generic"

# Anaconda OIDC issuer URL - endpoints will be auto-discovered
issuer_url = "https://id.anaconda.com"

# Alternative: Explicit endpoint configuration (uncomment if auto-discovery fails)
# userinfo_endpoint = "https://id.anaconda.com/userinfo"
# introspection_endpoint = "https://id.anaconda.com/oauth/introspect"

# Claim to use for user identification (Anaconda uses "sub" for user ID)
user_id_claim = "sub"

# Optional: Client credentials for introspection (if required by provider)
# client_id = "your-client-id"
# client_secret = "your-client-secret"

# Optional: Require specific scopes
# required_scopes = ["openid", "profile"]

# ============================================================================
# Backend MCP Servers (No auth - accessed via composer only)
# ============================================================================

# Calculator MCP Server (Proxied via STDIO)
[[servers.proxied.stdio]]
name = "calculator"
command = ["python", "mcp1.py"]
restart_policy = "never"
# Calculator tools: add, subtract, multiply, divide

# Echo MCP Server (Proxied via STDIO)
[[servers.proxied.stdio]]
name = "echo"
command = ["python", "mcp2.py"]
restart_policy = "never"
# Echo tools: ping, echo, reverse, uppercase, lowercase, count_words
