# MCP Compose Configuration
# GitHub OAuth2 Authentication Example
#
# This example demonstrates using the generic OAuth2 provider with GitHub's
# OAuth endpoints. Token validation is done via GitHub's userinfo endpoint
# (https://api.github.com/user).

[composer]
name = "github-oauth-composer"
conflict_resolution = "prefix"  # Prefix tool names with server name
log_level = "INFO"

# ============================================================================
# Authentication Configuration
# ============================================================================
# Generic OAuth2 token validation using GitHub's API.
#
# The composer validates incoming bearer tokens by:
# 1. Calling GitHub's userinfo endpoint (https://api.github.com/user)
# 2. Extracting user ID from the "id" or "login" claim
#
# Clients must provide valid GitHub OAuth tokens in Authorization header:
#   Authorization: Bearer <your_github_oauth_token>
#
# To get an OAuth token, use the GitHub OAuth flow:
# 1. Register an OAuth App at https://github.com/settings/developers
# 2. Set callback URL to http://localhost:8080/callback
# 3. Use the oauth_client.py or web browser flow to get a token

[authentication]
enabled = true
providers = ["oauth2"]
default_provider = "oauth2"

[authentication.oauth2]
# Use generic provider for standard OAuth2/OIDC token validation
provider = "generic"

# GitHub API userinfo endpoint (GitHub doesn't use standard OIDC discovery)
userinfo_endpoint = "https://api.github.com/user"

# Claim to use for user identification (GitHub uses "login" for username, "id" for numeric ID)
user_id_claim = "login"

# Optional: Client credentials for introspection (not needed for GitHub userinfo)
# client_id = "your-github-client-id"
# client_secret = "your-github-client-secret"

# ============================================================================
# Backend MCP Servers (No auth - accessed via composer only)
# ============================================================================

# Calculator MCP Server (Proxied via STDIO)
[[servers.proxied.stdio]]
name = "calculator"
command = ["python", "mcp1.py"]
restart_policy = "never"
# Calculator tools: add, subtract, multiply, divide

# Echo MCP Server (Proxied via SSE)
# Start the SSE server with: python mcp2_sse.py
[[servers.proxied.sse]]
name = "echo"
url = "http://localhost:8081/sse"
timeout = 30
keep_alive = true
reconnect_on_failure = true
max_reconnect_attempts = 10
health_check_enabled = false
mode = "proxy"
# Echo tools: ping, echo, reverse, uppercase, lowercase, count_words

# Alternative: Echo MCP Server via HTTP Streaming (JSON Lines)
# Uncomment to use HTTP streaming instead of SSE
# [[servers.proxied.http]]
# name = "echo"
# url = "http://localhost:8082/stream"
# protocol = "lines"  # Options: lines, chunked, poll
# timeout = 30
# keep_alive = true
# reconnect_on_failure = true
# max_reconnect_attempts = 10
# poll_interval = 2
# health_check_enabled = false
# mode = "proxy"
# Note: Start the HTTP server with: python mcp2_http.py
